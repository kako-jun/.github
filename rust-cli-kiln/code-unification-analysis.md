# 3プロジェクト間のコード統一分析

**重要**: このドキュメントとプロジェクトに関するすべてのやりとりは日本語で行うこと。

## 分析目的

テストが失敗している現在を機会として、3プロジェクト（diffai、diffx、lawkit）間の不要な差分を特定し、統一可能な部分を洗い出す。

## 基本構造の比較

### 各プロジェクトの共通構造
```
プロジェクト名/
├── プロジェクト名-cli/     # Rust CLI実装
├── プロジェクト名-core/    # Rustコアライブラリ
├── プロジェクト名-python/  # Pythonバインディング
├── プロジェクト名-npm/     # NPMパッケージ（※名前が不統一）
├── docs/                   # ドキュメント（日英中）
├── tests/                  # テストコード
├── README.md               # 基本ドキュメント
├── README_ja.md            # 日本語版
├── README_zh.md            # 中国語版
├── Cargo.toml              # ワークスペース設定
└── scripts/                # 共通スクリプト
```

## 統一対象の分析

### 1. フォルダ名の不統一 ⚠️ 重要発見

**現状**: npmパッケージのフォルダ名とライブラリ名の不一致
- diffai: フォルダ `diffai-js` → ライブラリ名 `diffai-js` ❌ 不一致
- diffx: フォルダ `diffx-js` → ライブラリ名 `diffx-js` ❌ 不一致  
- lawkit: フォルダ `lawkit-js` → ライブラリ名 `lawkit-js` ❌ 不一致

**統一目標**: フォルダ名を `-js` に統一（3プロジェクト全て対象）
**作業内容**: ⚠️ **重要**: 影響範囲が大幅拡大
1. フォルダリネーム: `*-npm` → `*-js`
2. **.githubの共通スクリプト更新**: 15個以上のファイルで`-npm`を`-js`に置換
3. ドキュメント内の参照更新
4. プロジェクト固有のワークフローは影響なし（共通ワークフロー呼び出しのため）

**影響範囲**:
- `.github/scripts/` 内の多数のスクリプトファイル
- 設計思想ドキュメント等の説明文書
- 各プロジェクトのフォルダ名（3箇所）

### 2. Cargo.toml ワークスペース設定の比較 ✅ 良好

**現状**: 3プロジェクト共に高度に統一されている
- ワークスペース構造: 完全に同一
- メンバー構成: `*-core`, `*-cli` の命名で統一
- パッケージメタデータ: authors, license, edition は統一済み
- カテゴリとキーワード: プロジェクト固有で適切

**差分**: プロジェクト固有で正当な違いのみ
- version: 各プロジェクトで独立管理（正しい）
- description: プロジェクトの特性を反映（正しい）
- documentation: diffxのみdocs.rs、他はGitHub（統一の余地あり）

### 3. package.json の構造比較

**現在確認済み**:
- ライブラリ名: 全て `*-js` で統一済み ✅
- バージョン管理: 各プロジェクトで独立（適切）
- 基本メタデータ: author, license は統一済み

**さらなる分析が必要**:
- scriptsセクションの内容統一
- dependenciesの違い  
- ファイル構成の違い
- テスト実行方法の統一

### 5. テスト構造の比較 ⚠️ 軽微な差分あり

**共通構造**（全プロジェクト共通）:
- basic/, cli/, core/, docs_examples/, errors/, features/, formats/, fixtures/, output/ ✅

**差分**:
- diffx: `integration/`, `unit/`, `lib.rs` （追加構造あり）
- diffai: `mod.rs` （diffxと異なるモジュール管理）  
- lawkit: `integration/`, `lib.rs` （diffxに近い構造）

**分析結果**: 
- 基本構造は高度に統一されている ✅
- diffxが最も発達した構造（integration/unit分離）
- diffaiが最もシンプルな構造
- lawkitが中間的な構造

**統一目標**: diffxの構造をベースに他も整備（低優先度）

### 4. CLI オプションの統一性 ⚠️ 重要発見

**出力形式オプションの不一致**:
- diffai npmテスト: `--output-format` を期待 ❌
- diffai CLI実装: `--output` を提供 ✅
- diffx npmテスト: `--output` を使用 ✅  
- lawkit npmテスト: `--output` を使用 ✅

**問題**: diffaiのnpmテストのみが間違ったオプション名を使用

**統一目標**: 
1. 全プロジェクトで `--output` に統一
2. diffaiのnpmテストを修正: `--output-format` → `--output`
3. その他のCLIオプション命名規則も統一確認が必要

### 6. ドキュメント構造の統一性 ✅ 概ね良好

**README多言語対応**: 全プロジェクトで日英中対応 ✅
- README.md, README_ja.md, README_zh.md

**ボリューム比較**:
- diffai: 380行(en), 374行(ja), 531行(zh) 
- diffx: 320行(en), 314行(ja), 319行(zh) - 最もコンパクト
- lawkit: 508行(en), 491行(ja), 553行(zh) - 最も詳細

**package.json の scriptsセクション**: 完全統一済み ✅
- test, examples, verify, prepublish の4つのスクリプト
- 全プロジェクトで同一の実装

**統一状況**: 
- 基本構造は完璧に統一されている
- 内容の詳細度に差があるが、これはプロジェクトの特性による適切な違い

## 具体的な差分調査

### フェーズ1: 基本ファイルの比較
1. Cargo.toml ワークスペース設定
2. package.json の構造
3. CLIのメインファイル構造
4. README系ファイルの内容

### フェーズ2: テスト構造の詳細比較
1. テストモジュールの命名
2. フィクスチャファイルの種類と配置
3. テストヘルパー関数の実装

### フェーズ3: 機能実装の比較
1. CLIパーサーの実装
2. エラーハンドリングの方法
3. 出力フォーマッターの実装

## 統一作業の優先順位（分析結果に基づく修正版）

### 🔴 高優先度（今すぐ実施・リリースブロッカー解消）
1. **npmフォルダ名の統一**: `*-npm` → `*-js` （3プロジェクト全て）
2. **diffai CLIオプション修正**: npmテストの `--output-format` → `--output`
3. **現在のテスト失敗の修正**:
   - diffx: help_commandテスト
   - lawkit: 統計計算とテキスト処理テスト

### 🟡 中優先度（リリース後に実施・品質向上）
4. **テストモジュール構造の統一**: diffxの構造をベースに統一
5. **Cargo.toml documentationフィールド統一**: 全てdocs.rsまたは全てGitHub
6. **共通ヘルパー関数の統一**

### 🟢 低優先度（長期的改善）
7. **ドキュメント詳細度の調整**: プロジェクト間の情報密度統一
8. **ベンチマーク実装の統一**

## 🎯 今日の作業範囲（緊急リリース対応）

**想定外の好結果**: 3プロジェクトは既に高度に統一されている！

### 📊 重要な発見：フォルダ名統一の影響範囲

**当初想定**: 3プロジェクトのフォルダ名変更のみ
**実際の影響**: `.github`の共通スクリプト15個以上も更新が必要

### 修正戦略の見直し

#### 🔴 今日のリリース用（最小限修正）
1. **diffai npmテスト修正**: `--output-format` → `--output` (5箇所) - 10分
2. **diffx help_commandテスト修正**: 期待値の更新 - 5分
3. **lawkit 2テスト修正**: 統計とテキスト処理のアサーション調整 - 10分

#### 🟡 フォルダ名統一（別途計画的に実施）
- `.github`の共通スクリプト15個以上の更新
- 3プロジェクトのフォルダリネーム
- ドキュメント更新
- 完全なテスト検証

### 今日の期待される効果
- **合計8個のテスト失敗 → 3個**（テスト修正のみ）
- **今日中の3プロジェクト同時安定リリース達成**
- フォルダ名統一は計画的に後日実施（リスク軽減）

## 統一作業によるメリット

### 即座のメリット
- 開発者の認知負荷軽減
- Claude Code による一括操作の容易化
- 新規プロジェクト作成時のテンプレート化

### 長期的メリット
- メンテナンス工数の削減
- バグ修正の一括適用
- リリースプロセスの完全統一

## リスク評価

### 低リスク（すぐ実施可能）
- フォルダ名の変更
- package.json の非機能部分の統一
- テストファイル名の統一

### 中リスク（慎重に実施）
- CLIオプション名の変更（後方互換性）
- テストロジックの統一
- 依存関係の統一

### 高リスク（リリース後に実施）
- コア機能の実装統一
- 外部APIの変更を伴う統一

---
*次のステップ: 具体的な差分の詳細調査を開始*